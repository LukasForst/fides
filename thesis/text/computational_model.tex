\section{Computational Model of Fides}
\label{sec:computational-model}
This section describes how does Fides come up with a single most important value $st_{i,j}$ service trust. Service trust describes how much can local peer $i$ trust remote peer $j$.
Used algorithm, that computes $st_{i,j}$, is based on SORT\cite{sort} with modifications to fit our use case - a global peer-to-peer network for sharing threat intelligence. The modifications are based on the interaction evaluation strategies proposed in \ref{subsec:interaction-evaluation} and algorithms to solve cold start problem described in \ref{subsec:cold-start-problem}.

\subsection{Intuition}
In the following pages, we describe the process top-down starting with the most important parts - service trust - and then breaking it down to bits.
There are two main ideas behind the most of the equations. 

The first one is that we want to robustly capture average behavior of the peers. In order to do that, we will be computing average behavior and standard deviations from said behavior and normalizing them.

Secondly, we will be comparing and weighting first hand experience with the remote experience. 
First hand experience is what happened between local and remote peer during time they interacted. This can be, for example, threat intelligence sharing, file sharing or the results of recommendation protocol.
Remote experience is what happened between one remote peer and another remote peer. In other words, first hand experience for peer $j$ are actions between $j$ and $z$. When $j$ shares information about these action with peer $i$, for $i$ it is a remote experience.

\begin{table}[ht]
\centering
\begin{tabular}{ c | m{20em} }
 $i$ & local peer, instance of Fides \\
 \hline
 $j$ & remote peer somewhere on the internet \\
 \hline
 $st_{i, j}$ & service trust - how much $i$ trusts $j$ that it provides good service \\
 \hline
 $r_{i, j}$ & $i$'s reputation value about $j$ \\
 \hline
 $rt_{i, j}$ & $i$'s recommendation trust about $j$ \\
 \hline
 $sh_{i, j}$ & size of $i$'s service history with $j$ \\
 \hline
 $s^{k}_{i, j}$ & $i$'s satisfaction value with interaction with peer $j$ in window $k$\\
 \hline
 $w^{k}_{i, j}$ & weight of $i$'s interaction with $j$ in $k$ \\
 \hline
 $f^{k}_{i, j}$ & fading effect of $i$'s interaction with $j$ in $k$ \\
\end{tabular}
\caption{Fides Computational Model Notation}
\label{tab:notation-computational-model}
\end{table}

\vspace{5mm}

\noindent 
The table \ref{tab:notation-computational-model} describes the most important notation we use in the following sections.

\subsection{Service Trust}
\label{subsec:service-trust}
One of the major goals of the algorithm is to compute the service trust $st_{i,j}$.
We do that by weighting local experience with peer's $j$ service, with the reputation, $j$ got when it connected to the $i$. The weight here is size of the service interaction history $sh_{i,j}$ to maximal history size $sh_{max}$.

\begin{equation}\label{eq:service-trust}
st_{i,j}=\frac{sh_{i,j}}{sh_{max}} \cdot \left(cb_{i,j} - \frac{1}{2} ib_{i,j} \right) +\left(1-\frac{sh_{i,j}}{sh_{max}}\right) \cdot r_{i,j}
\end{equation}

The equation implies that the more interaction there was, between $i$ and $j$, the bigger impact on $st_{i,j}$ it has. 
In other words, the more $i$ and $j$ interact the less $i$ rely on the reputation that $i$ computed from the values provided by the network, at the time when $j$ was seen for the first time.

\subsection{Local Experience for Service Trust}
First part of the equation \ref{eq:service-trust} contains \textit{competence belief}, $cb_{i,j}$, and $ib_{i,j}$ - \textit{integrity belief}.
Both of the values are based solely on the interactions history that peer $i$ experienced with the peer $j$.

\subsubsection{Competence Belief}
\textit{Competence belief} represents how much did peer $j$ satisfy local peer $i$ with the past interactions. We measure it as an average of interactions from the past \cite{sort}.
\begin{equation}
\begin{split}
    cb_{i,j} &= \frac{1}{\beta_{cb}} \sum_{k=1}^{sh_{i, j}} s_{i,j}^{k} \cdot w_{i,j}^{k} \cdot f_{i,j}^{k} \\
    \beta_{cb} &= \sum_{k=1}^{sh_{i, j}} s_{i,j}^{k} \cdot w_{i,j}^{k}
\end{split}
\end{equation}
It holds that $0 \leq cb_{i,j} \leq 1$ and where $s^{k}_{i,j}$ is the evaluation of the interaction in window $k$, $w^{k}_{i, j}$ is the weight of the interaction (how important it was) and $f^{k}_{i,j}$ is the fading effect of that interaction. We describe $s^{k}_{i,j}$, $w^{k}_{i,j}$ and $f^{k}_{i,j}$ in greater detail in \ref{subsec:evaluating-an-interaction}. 
$\beta_{cb}$ is the normalization coefficient that ensures that $cb_{i, j}$ stays within the interval of $0 \leq cb_{i,j} \leq 1$.

\subsubsection{Integrity Belief}
\textit{Integrity belief} is a level of confidence in predictability of future interactions. $ib_{i,j}$ is then measured as deviation from the average behavior $cb_{i,j}$. 
Therefore, $ib_{i,j}$ is calculated as an approximation to the standard deviation of interaction parameters\cite{sort}.
\begin{equation}
\begin{split}
    ib_{i,j} &= \sqrt{\frac{1}{sh_{i,j}} \sum_{k=1}^{sh_{i,j}}\left(s_{i,j}^{k} \cdot w_{i,j}^{\mu} \cdot f_{i,j}^{\mu} - cb_{i,j}\right)^{2}} \\
    f_{i,j}^{\mu} &= \frac{1}{sh_{i, j}} \sum_{k=1}^{sh_{i,j}} f^{k}_{i,j} \\
    w_{i,j}^{\mu} &= \frac{1}{sh_{i, j}} \sum_{k=1}^{sh_{i,j}} w^{k}_{i,j}
\end{split}
\end{equation}

It holds that $0 \leq ib_{i,j} \leq 1$.
The more consistent behavior peer $j$ has, the lower the $ib_{i,j}$ is. Consistency is highly desired property as the local peer then have more precise estimates about future behavior of the remote peer.

\subsection{Evaluating an Interaction}
\label{subsec:evaluating-an-interaction}
In section \ref{subsec:interaction-evaluation}, we described multiple strategies, how to compute $s^{k}_{i,j}$ - satisfaction value with $k$th interaction of the local peer $i$ with peer $j$.
However, not all interactions are same - some of the interactions are more important then the others. 
Moreover, because peers can change their behavior, most recent interactions should be more important the the interactions that happened long time ago.

\subsubsection{Weight of the Interaction}
Because each interaction is different and its importance is different, we have $w^{k}_{i,j}$ that measures the importance.
Weight belongs to interval $0 \leq w^{k}_{i,j} \leq 1$ and Fides implements it as a discrete function of interaction type. 
For example, weight of interaction when remote peer shares the threat intelligence is higher, then when the peer sends threat intelligence request.


\subsubsection{Fading Effect}
Fading effect $f^{k}_{i,j}$ determines \textit{"how much does algorithm forget"} as the algorithm prefers most recent interactions over past interactions and thus $f^{k}_{i,j}$ reduces weight of the past interactions. 
$f^{k}_{i,j}$ is a \textit{non-increasing function} of interaction and time, or an index of said interaction in the history.
This depends on the implementation - Fides implements it as a decreasing linear function $f^{k}_{i,j} = \frac{k}{sh_{i,j}}$. 
However, it can be implemented as a function of time as well. In that case, the function does not depend on $k$ (as an index of a time window) bur rather on the time, when the interaction happened.

\subsection{Reputation and Recommendations}
In order to mitigate cold start problem outlined in section \ref{subsec:cold-start-problem} and in cases when there are no or little interactions between $i$ and $j$, the algorithm relies on $r_{i,j}$ - \textit{reputation value}. 
$r_{i,j}$ is the second part of the service trust equation \ref{eq:service-trust} that introduces \textit{remote experience} to the service trust.

Reputation value is computed from the received recommendations. 
When the local peer $i$ encounters remote peer $j$ for the first time and it does not have any data about its trustworthiness, $i$ can request recommendations on peer $j$ from $i$'s most trusted peers.

A single recommendation response from peer $z$ about giving recommendation to peer $i$ about peer $j$ contains following data.
\begin{itemize}
    \item $cb_{z,j}$, $ib_{z,j}$ - summary of $z$'s interactions with $j$, competence and integrity believes
    \item $sh_{z,j}$ - service history size, number of the interactions between $z$ and $j$ - the more interactions they had, then the $z$'s recommendation has more credibility
    \item $r_{z, j}$ - summary of recommendations that $z$ received on $j$
    \item $\eta_{z,j}$ - number of peers that provided recommendations for $j$ when $j$ was new to $z$ and their recommendation was used to compute $r_{z,j}$
\end{itemize}

\begin{equation}
\begin{split}
    r_{i, j}=\frac{\lfloor\mu_{sh}\rfloor}{sh_{max}} \cdot \left(ecb_{i,j}-\frac{1}{2} eib_{i, j}\right) + \left(1-\frac{\lfloor\mu_{sh}\rfloor}{sh_{max}}\right) \cdot er_{i,j}
\end{split}
\end{equation}

